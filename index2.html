<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üèõÔ∏è Mus√©e Moderne</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');

        /* Variables CSS */
        :root {
            --primary-color: #6366f1;
            --secondary-color: #4f46e5;
            --accent-color: #ec4899;
            --background: #f8fafc;
            --card-bg: #ffffff;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
        }

        /* Mode sombre */
        @media (prefers-color-scheme: dark) {
            :root {
                --background: #0f172a;
                --card-bg: #1e293b;
                --text-primary: #f1f5f9;
                --text-secondary: #cbd5e1;
            }
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* Reset et styles de base */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        body {
            background-color: var(--background);
            color: var(--text-primary);
            line-height: 1.6;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        /* Header stylis√© */
        header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 2rem;
            text-align: center;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        header h1 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            animation: float 6s ease-in-out infinite;
        }

        /* Navigation moderne */
        nav {
            background: var(--card-bg);
            padding: 1rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
            transition: background-color 0.3s ease;
        }

        nav ul {
            list-style: none;
            display: flex;
            justify-content: center;
            gap: 2rem;
            max-width: 1200px;
            margin: 0 auto;
            flex-wrap: wrap;
        }

        nav a {
            color: var(--text-primary);
            text-decoration: none;
            font-weight: 500;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        nav a:hover, nav a.active {
            background: var(--primary-color);
            color: white;
            transform: translateY(-2px);
        }

        /* Container principal */
        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 2rem;
        }

        /* Cards stylis√©es */
        .card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
            animation: fadeIn 0.6s ease-out;
            transition: transform 0.3s ease, background-color 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        /* Dashboard grid */
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }

        /* Compteur de visiteurs stylis√© */
        .visitor-counter {
            font-size: 3rem;
            text-align: center;
            margin: 2rem 0;
            color: var(--primary-color);
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 1rem;
        }

        .visitor-counter.alert {
            color: var(--danger-color);
            animation: pulse 1s infinite;
        }

        .capacity-meter {
            width: 100%;
            height: 1rem;
            background-color: #e2e8f0;
            border-radius: 1rem;
            margin-top: 1rem;
            overflow: hidden;
        }

        .capacity-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--success-color), var(--primary-color), var(--danger-color));
            border-radius: 1rem;
            transition: width 0.5s ease;
        }

        /* Formulaires modernes */
        .form-group {
            margin-bottom: 1.5rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        input, select, textarea {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background-color: var(--card-bg);
            color: var(--text-primary);
        }

        input:focus, select:focus, textarea:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
        }

        /* Boutons stylis√©s */
        button {
            background: var(--primary-color);
            color: white;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        button:hover {
            background: var(--secondary-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        button.danger {
            background: var(--danger-color);
        }

        button.danger:hover {
            background: #dc2626;
        }

        button.success {
            background: var(--success-color);
        }

        button.success:hover {
            background: #059669;
        }

        /* Stats cards */
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }

        .stat-card {
            background: var(--card-bg);
            padding: 2rem;
            border-radius: 16px;
            text-align: center;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary-color);
            margin: 1rem 0;
        }

        /* Liste des visiteurs */
        .visitor-item {
            background: var(--card-bg);
            padding: 1.5rem;
            margin-bottom: 1rem;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .visitor-item:hover {
            transform: translateX(5px);
        }

        /* Badges et statuts */
        .badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.875rem;
            font-weight: 500;
            margin-left: 0.5rem;
        }

        .badge-success {
            background: var(--success-color);
            color: white;
        }

        .badge-warning {
            background: var(--warning-color);
            color: white;
        }

        .badge-danger {
            background: var(--danger-color);
            color: white;
        }

        /* Notifications */
        .notification-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .notification {
            padding: 1rem 2rem;
            border-radius: 8px;
            background: var(--card-bg);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            animation: slideIn 0.5s ease-out;
            display: flex;
            align-items: center;
            justify-content: space-between;
            min-width: 300px;
        }

        .notification.success {
            border-left: 4px solid var(--success-color);
        }

        .notification.warning {
            border-left: 4px solid var(--warning-color);
        }

        .notification.danger {
            border-left: 4px solid var(--danger-color);
        }

        .notification .close-btn {
            background: transparent;
            color: var(--text-secondary);
            padding: 0.25rem;
            margin-left: 1rem;
        }

        .notification .close-btn:hover {
            color: var(--danger-color);
            transform: none;
            box-shadow: none;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Responsive design */
        @media (max-width: 768px) {
            nav ul {
                flex-direction: column;
                align-items: center;
            }

            .stats {
                grid-template-columns: 1fr;
            }

            header h1 {
                font-size: 2rem;
            }
            
            .visitor-item {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .visitor-item button {
                margin-top: 1rem;
                width: 100%;
            }
        }

        /* Graphiques */
        .chart-container {
            width: 100%;
            height: 300px;
            margin: 2rem 0;
        }

        /* Modal de confirmation */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: var(--card-bg);
            padding: 2rem;
            border-radius: 16px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.2);
            transform: translateY(20px);
            transition: transform 0.3s ease;
        }

        .modal-overlay.active .modal {
            transform: translateY(0);
        }

        .modal-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            margin-top: 2rem;
        }
    </style>
</head>
<body>
    <header>
        <h1>üèõÔ∏è Syst√®me de Gestion du Mus√©e</h1>
        <p>Une exp√©rience culturelle unique</p>
    </header>

    <nav>
        <ul>
            <li><a href="#" id="nav-dashboard" onclick="showSection('dashboard')"><i class="fas fa-tachometer-alt"></i> Tableau de bord</a></li>
            <li><a href="#" id="nav-visitors" onclick="showSection('visitors')"><i class="fas fa-users"></i> Visiteurs</a></li>
            <li><a href="#" id="nav-stats" onclick="showSection('stats')"><i class="fas fa-chart-bar"></i> Statistiques</a></li>
            <li><a href="index.html" onclick="confirmLogout()"><i class="fas fa-sign-out-alt"></i> D√©connexion</a></li>
        </ul>
    </nav>

    <div class="container">
        <!-- Section Dashboard -->
        <div id="dashboard" class="section">
            <h2><i class="fas fa-tachometer-alt"></i> Tableau de bord</h2>
            <div class="dashboard">
                <div class="card">
                    <h3>üë• Visiteurs actuels</h3>
                    <div class="visitor-counter" id="visitorCounterDisplay">
                        <span id="currentVisitors">0</span>/50
                    </div>
                    <div class="capacity-meter">
                        <div class="capacity-fill" id="capacityFill" style="width: 0%;"></div>
                    </div>
                </div>
                <div class="card">
                    <h3>üé® Exposition Permanente</h3>
                    <div class="stat-value"><span id="permanentCount">0</span></div>
                    <button onclick="showSection('visitors')" class="success"><i class="fas fa-plus-circle"></i> Ajouter un visiteur</button>
                </div>
                <div class="card">
                    <h3>‚ú® Exposition Temporaire</h3>
                    <div class="stat-value"><span id="temporaryCount">0</span></div>
                    <button onclick="showSection('visitors')" class="success"><i class="fas fa-plus-circle"></i> Ajouter un visiteur</button>
                </div>
            </div>
            <div class="card">
                <h3>üìã R√©sum√© des activit√©s</h3>
                <div id="activitySummary">
                    <p>Bienvenue dans le syst√®me de gestion du mus√©e. Utilisez le menu de navigation pour acc√©der aux diff√©rentes fonctionnalit√©s.</p>
                </div>
            </div>
        </div>

        <!-- Section Visiteurs -->
        <div id="visitors" class="section" style="display: none;">
            <h2><i class="fas fa-users"></i> Gestion des Visiteurs</h2>
            <div class="card">
                <h3>üéüÔ∏è Enregistrer un nouveau visiteur</h3>
                <form id="visitorForm" onsubmit="return addVisitor(event)">
                    <div class="form-group">
                        <label>Num√©ro du visiteur :</label>
                        <input type="text" id="visitorId" disabled placeholder="G√©n√©r√© automatiquement">
                    </div>
                    <div class="form-group">
                        <label for="ticketType">Type de billet :</label>
                        <select id="ticketType" required>
                            <option value="permanent">üé® Exposition Permanente</option>
                            <option value="temporary">‚ú® Exposition Temporaire</option>
                            <option value="both">üåü Les deux expositions</option>
                        </select>
                    </div>
                    <button type="submit" class="success"><i class="fas fa-plus-circle"></i> Enregistrer l'entr√©e</button>
                </form>
            </div>
            <div class="card">
                <h3>üë• Liste des visiteurs actuels</h3>
                <div id="visitorList" class="visitor-list"></div>
            </div>
        </div>

        <!-- Section Statistiques -->
        <div id="stats" class="section" style="display: none;">
            <h2><i class="fas fa-chart-bar"></i> Statistiques</h2>
            <div class="card">
                <h3>üìä R√©partition des visiteurs</h3>
                <div class="stats">
                    <div class="stat-card">
                        <h4>üé® Exposition Permanente</h4>
                        <div class="stat-value"><span id="permanentStats">0</span>%</div>
                    </div>
                    <div class="stat-card">
                        <h4>‚ú® Exposition Temporaire</h4>
                        <div class="stat-value"><span id="temporaryStats">0</span>%</div>
                    </div>
                    <div class="stat-card">
                        <h4>üåü Les deux expositions</h4>
                        <div class="stat-value"><span id="bothStats">0</span>%</div>
                    </div>
                </div>
            </div>
            <div class="card">
                <h3>üìÖ Fr√©quentation hebdomadaire</h3>
                <canvas id="weeklyVisitorsChart"></canvas>
            </div>
            <div class="card">
                <h3>‚è±Ô∏è Dur√©e moyenne des visites</h3>
                <div class="stat-value" id="averageDuration">-- min</div>
            </div>
        </div>
    </div>

    <!-- Modal de confirmation -->
    <div class="modal-overlay" id="confirmModal">
        <div class="modal">
            <h3 id="modalTitle">Confirmation</h3>
            <p id="modalMessage">√ätes-vous s√ªr de vouloir effectuer cette action ?</p>
            <div class="modal-buttons">
                <button id="modalCancelBtn" onclick="closeModal()">Annuler</button>
                <button id="modalConfirmBtn" class="danger">Confirmer</button>
            </div>
        </div>
    </div>

    <!-- Conteneur de notifications -->
    <div class="notification-container" id="notificationContainer"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script>
        // Variables globales
let currentVisitors = 0;
let visitors = [];
let permanentCount = 0;
let temporaryCount = 0;
let bothCount = 0;
let visitorCounter = 1; // Pour num√©roter automatiquement les visiteurs
let weeklyChart = null;
let activeSection = 'dashboard';
let weeklyStats = {
    "Lundi": 0,
    "Mardi": 0,
    "Mercredi": 0,
    "Jeudi": 0,
    "Vendredi": 0,
    "Samedi": 0,
    "Dimanche": 0
};

// Constantes pour l'API
const API_BASE_URL = 'api'; // R√©pertoire o√π se trouvent vos fichiers PHP d'API

// Initialisation
document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('visitorId').value = "V-" + visitorCounter;
    showSection('dashboard');
    
    // Charger les donn√©es initiales depuis l'API
    loadVisitors();
    loadStats();
    
    // Mise √† jour p√©riodique des donn√©es
    setInterval(loadStats, 60000);
});

// Fonction pour charger la liste des visiteurs depuis l'API
function loadVisitors() {
    fetch(`${API_BASE_URL}/visitors.php`)
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success') {
                visitors = data.data.map(visitor => ({
                    id: parseInt(visitor.id_visiteur),
                    customId: "V-" + visitor.id_visiteur,
                    ticketType: visitor.ticket_nom.toLowerCase().includes('permanente') ? 'permanent' :
                               visitor.ticket_nom.toLowerCase().includes('temporaire') ? 'temporary' : 'both',
                    entryTime: new Date(visitor.h_arrivee),
                    exitTime: visitor.h_depart ? new Date(visitor.h_depart) : null,
                    day: new Date(visitor.h_arrivee).toLocaleDateString('fr-FR', { 
                        weekday: 'long', 
                        day: 'numeric', 
                        month: 'long', 
                        year: 'numeric' 
                    })
                }));
                
                updateCounts();
                updateDisplay();
            } else {
                showNotification('‚ùå Erreur lors du chargement des visiteurs: ' + data.message, 'danger');
            }
        })
        .catch(error => {
            console.error('Erreur:', error);
            showNotification('‚ùå Erreur de connexion √† l\'API', 'danger');
        });
}

// Fonction pour charger les statistiques depuis l'API
function loadStats() {
    // Charger les statistiques g√©n√©rales
    fetch(`${API_BASE_URL}/stats.php?type=general`)
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success') {
                currentVisitors = data.data.currentVisitors;
                permanentCount = data.data.permanentCount;
                temporaryCount = data.data.temporaryCount;
                bothCount = data.data.bothCount;
                
                updateDisplay();
                updateStats();
            }
        })
        .catch(error => console.error('Erreur:', error));
    
    // Charger les statistiques hebdomadaires si on est dans la section stats
    if (activeSection === 'stats') {
        fetch(`${API_BASE_URL}/stats.php?type=weekly`)
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    weeklyStats = data.data;
                    updateWeeklyChart();
                }
            })
            .catch(error => console.error('Erreur:', error));
        
        fetch(`${API_BASE_URL}/stats.php?type=duration`)
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    document.getElementById('averageDuration').textContent = data.data.averageDuration + ' min';
                }
            })
            .catch(error => console.error('Erreur:', error));
    }
}

// Gestion des visiteurs
function addVisitor(event) {
    event.preventDefault();
    if (currentVisitors >= 50) {
        showNotification('‚ö†Ô∏è Le mus√©e est complet. Veuillez patienter.', 'warning');
        return false;
    }

    const ticketType = document.getElementById('ticketType').value;
    
    // Donn√©es suppl√©mentaires (optionnelles, √† adapter selon vos besoins)
    const visitorData = {
        ticketType: ticketType,
        nom: "", // Ces champs pourraient √™tre ajout√©s √† votre formulaire
        prenom: "",
        age: 0,
        tel: "",
        mail: ""
    };
    
    // Envoyer les donn√©es au serveur
    fetch(`${API_BASE_URL}/visitors.php`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(visitorData)
    })
    .then(response => response.json())
    .then(data => {
        if (data.status === 'success') {
            // Mise √† jour r√©ussie
            showNotification(`‚úÖ Visiteur ${data.data.customId} enregistr√© !`, 'success');
            
            // Recharger les donn√©es
            loadVisitors();
            loadStats();
        } else {
            showNotification('‚ùå Erreur: ' + data.message, 'danger');
        }
    })
    .catch(error => {
        console.error('Erreur:', error);
        showNotification('‚ùå Erreur de connexion', 'danger');
    });
    
    return false;
}

function removeVisitor(visitorId) {
    // Configurer le modal de confirmation
    document.getElementById('modalTitle').textContent = 'Confirmer la sortie';
    document.getElementById('modalMessage').textContent = 'Confirmez-vous la sortie de ce visiteur ?';
    
    const confirmBtn = document.getElementById('modalConfirmBtn');
    confirmBtn.onclick = function() {
        // Envoyer la demande de sortie √† l'API
        fetch(`${API_BASE_URL}/visitors.php`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ id: visitorId })
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success') {
                showNotification('üö™ Visiteur enregistr√© comme sorti.', 'success');
                
                // Recharger les donn√©es
                loadVisitors();
                loadStats();
            } else {
                showNotification('‚ùå Erreur: ' + data.message, 'danger');
            }
            closeModal();
        })
        .catch(error => {
            console.error('Erreur:', error);
            showNotification('‚ùå Erreur de connexion', 'danger');
            closeModal();
        });
    };
    
    // Afficher le modal
    document.getElementById('confirmModal').classList.add('active');
}

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('visitorId').value = "V-" + visitorCounter;
            showSection('dashboard');
            setInterval(updateTimeBasedStats, 60000); // Mise √† jour toutes les minutes
        });

        // Gestion de l'affichage des sections
        function hideAllSections() {
            document.querySelectorAll('.section').forEach(section => {
                section.style.display = 'none';
            });
            
            // D√©sactiver tous les liens de navigation
            document.querySelectorAll('nav a').forEach(link => {
                link.classList.remove('active');
            });
        }

        function showSection(sectionId) {
            hideAllSections();
            activeSection = sectionId;
            
            // Afficher la section
            const section = document.getElementById(sectionId);
            section.style.display = 'block';
            section.style.animation = 'fadeIn 0.5s ease-out';
            
            // Activer le lien de navigation
            const navLink = document.getElementById('nav-' + sectionId);
            if (navLink) navLink.classList.add('active');
            
            updateDisplay();
            
            // Mettre √† jour les graphiques si n√©cessaire
            if (sectionId === 'stats') {
                updateWeeklyChart();
            }
        }

        // Gestion des visiteurs
        function addVisitor(event) {
            event.preventDefault();
            if (currentVisitors >= 50) {
                showNotification('‚ö†Ô∏è Le mus√©e est complet. Veuillez patienter.', 'warning');
                return false;
            }

            const ticketType = document.getElementById('ticketType').value;
            const today = new Date();
            const visitorId = "V-" + visitorCounter++; // G√©n√®re un ID unique
            const dayName = today.toLocaleDateString('fr-FR', { weekday: 'long' });
            
            const visitor = {
                id: Date.now(),
                customId: visitorId,
                ticketType: ticketType,
                entryTime: today,
                exitTime: null,
                day: today.toLocaleDateString('fr-FR', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' })
            };

            visitors.push(visitor);
            currentVisitors++;
            weeklyStats[dayName]++;
            
            // Mettre √† jour les compteurs
            updateCounts();
            
            showNotification(`‚úÖ Visiteur ${visitorId} enregistr√© !`, 'success');
            updateDisplay();
            
            return false;
        }

        function removeVisitor(visitorId) {
            // Trouver l'indice du visiteur dans le tableau
            const visitorIndex = visitors.findIndex(v => v.id === visitorId);
            
            if (visitorIndex === -1) return;
            
            // Configurer le modal de confirmation
            document.getElementById('modalTitle').textContent = 'Confirmer la sortie';
            document.getElementById('modalMessage').textContent = 'Confirmez-vous la sortie de ce visiteur ?';
            
            const confirmBtn = document.getElementById('modalConfirmBtn');
            confirmBtn.onclick = function() {
                // Enregistrer l'heure de sortie
                visitors[visitorIndex].exitTime = new Date();
                
                // Calculer la dur√©e de la visite
                const duration = (visitors[visitorIndex].exitTime - visitors[visitorIndex].entryTime) / (1000 * 60); // en minutes
                
                // D√©cr√©menter le compteur g√©n√©ral
                currentVisitors--;
                
                // Mettre √† jour les compteurs
                updateCounts();
                
                showNotification('üö™ Visiteur enregistr√© comme sorti.', 'success');
                updateDisplay();
                updateTimeBasedStats();
                closeModal();
            };
            
            // Afficher le modal
            document.getElementById('confirmModal').classList.add('active');
        }

        // Mettre √† jour les compteurs par type d'exposition
        function updateCounts() {
            permanentCount = visitors.filter(v => v.ticketType === 'permanent' && !v.exitTime).length;
            temporaryCount = visitors.filter(v => v.ticketType === 'temporary' && !v.exitTime).length;
            bothCount = visitors.filter(v => v.ticketType === 'both' && !v.exitTime).length;
            
            // Mettre √† jour les statistiques
            updateStats();
        }

        // Mise √† jour des statistiques
        function updateStats() {
            const total = permanentCount + temporaryCount + bothCount;
            if (total === 0) {
                document.getElementById('permanentStats').textContent = '0';
                document.getElementById('temporaryStats').textContent = '0';
                document.getElementById('bothStats').textContent = '0';
                return;
            }
            
            document.getElementById('permanentStats').textContent = Math.round((permanentCount / total) * 100);
            document.getElementById('temporaryStats').textContent = Math.round((temporaryCount / total) * 100);
            document.getElementById('bothStats').textContent = Math.round((bothCount / total) * 100);
        }

        // Mise √† jour des statistiques bas√©es sur le temps
        function updateTimeBasedStats() {
            // Calculer la dur√©e moyenne des visites termin√©es
            const completedVisits = visitors.filter(v => v.exitTime);
            if (completedVisits.length === 0) {
                document.getElementById('averageDuration').textContent = '-- min';
                return;
            }
            
            const totalDuration = completedVisits.reduce((sum, v) => {
                return sum + (v.exitTime - v.entryTime) / (1000 * 60);
            }, 0);
            
            const averageDuration = Math.round(totalDuration / completedVisits.length);
            document.getElementById('averageDuration').textContent = averageDuration + ' min';
            
            // Mettre √† jour le r√©sum√© d'activit√©
            updateActivitySummary();
        }

        // Mise √† jour du r√©sum√© d'activit√©
        function updateActivitySummary() {
            const now = new Date();
            const today = now.toLocaleDateString('fr-FR');
            const completedToday = visitors.filter(v => v.exitTime && new Date(v.entryTime).toLocaleDateString('fr-FR') === today).length;
            
            document.getElementById('activitySummary').innerHTML = `
                <p><i class="fas fa-calendar-day"></i> <strong>Aujourd'hui :</strong> ${today}</p>
                <p><i class="fas fa-users"></i> <strong>Visiteurs actuels :</strong> ${currentVisitors}/50</p>
                <p><i class="fas fa-door-open"></i> <strong>Visites termin√©es aujourd'hui :</strong> ${completedToday}</p>
            `;
        }

        // Mise √† jour de l'affichage
        function updateDisplay() {
            // Mettre √† jour les compteurs
            document.getElementById('currentVisitors').textContent = currentVisitors;
            document.getElementById('permanentCount').textContent = permanentCount;
            document.getElementById('temporaryCount').textContent = temporaryCount;
            
            // Mettre √† jour le compteur d'occupation
            const capacityPercentage = (currentVisitors / 50) * 100;
            document.getElementById('capacityFill').style.width = capacityPercentage + '%';
            
            // Changer le style du compteur si pr√®s de la capacit√© maximale
            const counterDisplay = document.getElementById('visitorCounterDisplay');
            if (capacityPercentage > 90) {
                counterDisplay.classList.add('alert');
            } else {
                counterDisplay.classList.remove('alert');
            }
            
            // Afficher la liste des visiteurs
            document.getElementById('visitorList').innerHTML = visitors
                .filter(visitor => !visitor.exitTime) // Afficher seulement les visiteurs actifs
                .map(visitor => `
                    <div class="visitor-item">
                        <div>
                            <p><strong>ü™™ ID :</strong> ${visitor.customId}</p>
                            <p><strong>üìÖ Jour :</strong> ${visitor.day}</p>
                            <p><strong>üéüÔ∏è Billet :</strong> ${
                                visitor.ticketType === 'permanent' ? 'üé® Exposition Permanente' :
                                visitor.ticketType === 'temporary' ? '‚ú® Exposition Temporaire' : 'üåü Les deux expositions'
                            }</p>
                            <p><strong>‚è±Ô∏è Entr√©e :</strong> ${new Date(visitor.entryTime).toLocaleTimeString('fr-FR')}</p>
                        </div>
                        <button class="danger" onclick="removeVisitor(${visitor.id})"><i class="fas fa-sign-out-alt"></i> Enregistrer la sortie</button>
                    </div>
                `).join('');
            
            // Mettre √† jour l'ID du prochain visiteur
            document.getElementById('visitorId').value = "V-" + visitorCounter;
            
            // Mettre √† jour le r√©sum√© d'activit√©
            updateActivitySummary();
        }

        // Fermer le modal
function closeModal() {
    document.getElementById('confirmModal').classList.remove('active');
}

// Fonction pour confirmer la d√©connexion
function confirmLogout() {
    document.getElementById('modalTitle').textContent = 'Confirmer la d√©connexion';
    document.getElementById('modalMessage').textContent = '√ätes-vous s√ªr de vouloir vous d√©connecter ?';
    
    const confirmBtn = document.getElementById('modalConfirmBtn');
    confirmBtn.onclick = function() {
        window.location.href = 'index.html';
    };
    
    document.getElementById('confirmModal').classList.add('active');
    return false;
}

// Afficher une notification
function showNotification(message, type = 'success') {
    const notificationContainer = document.getElementById('notificationContainer');
    const notification = document.createElement('div');
    notification.className = `notification ${type}`;
    notification.innerHTML = `
        <div>${message}</div>
        <button class="close-btn" onclick="this.parentElement.remove()">
            <i class="fas fa-times"></i>
        </button>
    `;
    
    notificationContainer.appendChild(notification);
    
    // Automatiquement supprimer la notification apr√®s 5 secondes
    setTimeout(() => {
        notification.remove();
    }, 5000);
}

// Cr√©ation et mise √† jour du graphique hebdomadaire
function updateWeeklyChart() {
    const ctx = document.getElementById('weeklyVisitorsChart').getContext('2d');
    
    if (weeklyChart) {
        weeklyChart.destroy();
    }
    
    weeklyChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: Object.keys(weeklyStats),
            datasets: [{
                label: 'Nombre de visiteurs',
                data: Object.values(weeklyStats),
                backgroundColor: 'rgba(99, 102, 241, 0.7)',
                borderColor: 'rgba(99, 102, 241, 1)',
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        stepSize: 1
                    }
                }
            },
            animation: {
                duration: 1500,
                easing: 'easeOutQuart'
            }
        }
    });
}

// Simulation de donn√©es pour d√©mo
function simulateVisitors() {
    // Ajouter quelques visiteurs pour la d√©mo
    const types = ['permanent', 'temporary', 'both'];
    const days = ["Lundi", "Mardi", "Mercredi", "Jeudi", "Vendredi", "Samedi", "Dimanche"];
    const today = new Date();
    
    // Simuler des statistiques hebdomadaires
    days.forEach(day => {
        weeklyStats[day] = Math.floor(Math.random() * 15);
    });
    
    // Simuler des visiteurs actuels
    for (let i = 0; i < 12; i++) {
        const ticketType = types[Math.floor(Math.random() * types.length)];
        const dayName = today.toLocaleDateString('fr-FR', { weekday: 'long' });
        
        const visitor = {
            id: Date.now() + i,
            customId: "V-" + visitorCounter++,
            ticketType: ticketType,
            entryTime: new Date(today.getTime() - Math.floor(Math.random() * 3600000)),
            exitTime: null,
            day: today.toLocaleDateString('fr-FR', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' })
        };
        
        visitors.push(visitor);
        currentVisitors++;
    }
    
    // Simuler des visiteurs sortis
    for (let i = 0; i < 8; i++) {
        const ticketType = types[Math.floor(Math.random() * types.length)];
        const entryTime = new Date(today.getTime() - Math.floor(Math.random() * 12 * 3600000));
        const dayName = entryTime.toLocaleDateString('fr-FR', { weekday: 'long' });
        
        const visitor = {
            id: Date.now() + i + 100,
            customId: "V-" + visitorCounter++,
            ticketType: ticketType,
            entryTime: entryTime,
            exitTime: new Date(entryTime.getTime() + Math.floor(Math.random() * 3 * 3600000)),
            day: entryTime.toLocaleDateString('fr-FR', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' })
        };
        
        visitors.push(visitor);
    }
    
    updateCounts();
    updateDisplay();
    updateTimeBasedStats();
}

// Ex√©cuter la simulation au chargement
setTimeout(simulateVisitors, 500);
</script>
</body>
</html>